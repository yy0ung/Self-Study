# Git 내부구조와 동작

<br>

### 1. 분산 버전 관리
- 각자의 저장소에 파일과 히스토리를 모두 복사
- 서버에 문제가 생기면 복사한 복제물로 다시 작업을 시작하면 됨.
- 모든 복제본이 서버 그 자체이며 모두가 원본을 가지고 있고 백업본을 가지고 있다고 생각하면 됨.

<br><br>

### 2. Git 기본   
- git 은 파일의 내용을 주소로 이용함.
    - 파일의 내용을 해시 (SHA-1 해시 사용) 한 값을 키 값으로 저장. 이후에 이 키 값을 기준으로 파일을 찾음.
    - 해시한 키 값은 거의 유일한 값이기 때문에 고유 키로 사용이 가능.
- `.git/objects` 디렉토리 아래에 키의 앞 두자리로 디렉토리를 만들고, 그 안에 나머지 키 값을 파일명으로 만들어서 저장.

<br><br>

### 3. Git 구성
- `objects` 
  - `blob` (binary large object)
    - 일반 파일의 내용을 저장
    - 파일명 등의 메타데이터를 저장하지 않고, 바이너리 데이터만 저장.
        - 동일한 내용을 가진 파일이 여러개 있어도 하나의 `blob` 만 생성.
    - 파일의 내용을 zlib 으로 압축하여 `blob` 오브젝트 안에 저장.
  - `tree`
    - `blob` 이 어떤 디렉토리에 어떤 이름으로 저장되어 있는지를 나타냄
    - 특정 시점의 한 디렉토리를 표현할 수 있음. 여기에 파일명, 기본 속성 등의 메타데이터가 포함됨.
    - `tree` 아래에는 여러 개의 `blob`, `tree` 들어갈 수 있음.
  - `commit`
    - 현재의 스냅샷에 대한 정보를 담는 오브젝트
    - 하나 커밋당 하나의 커밋 오브젝트가 생성됨.
  
<br>

- `refs`
  - `HEAD`
    - 현재 작업 중인 branch 에 따라 값이 변경됨.
    - 현재 작업 중인 branch 의 최종 commit 을 가리킴.
  - `tag`
    - 특정 커밋을 태그해 두는 것. (특정 커밋을 가리키는 링크)
    - 수정은 불가능.

<br>

- `index`
  - 현재 Staging Area에 있는 파일들의 목록과 메타데이터를 가지고 있음
  - 커밋할 준비가 된 파일들을 추적하고 저장하는 역할


<br><br>

### 4. Git 단계와 명령어

- `modifed (working directory)` : clone 을 받은 이후 file 을 수정한 경우.
- `staged (staging area)` :  commit 하기 전 git add 명령어를 수행한 경우.
- `commited (repository)` : commit 한 상태.

<br>

- `git add`
    - working directory → staging area
    - 커밋을 준비하는 명령어
- `git commit`
    - staging area → respository
    - 커밋 기록과 파일이 스냅샷으로 기록됨.